### ── Build stage ───────────────────────────────────────────────────
FROM node:20-alpine AS builder

WORKDIR /app
COPY package.json pnpm-lock.yaml* yarn.lock* ./
RUN npm install                          # or pnpm / yarn – change if needed
COPY frontend ./frontend
# Provide the API URL for the build (overridden at runtime if necessary)
ARG VITE_API_BACKEND_URL=http://localhost:8000/api/v1
ENV VITE_API_BACKEND_URL=${VITE_API_BACKEND_URL}
RUN npm run build                        # vite build → frontend/dist

### --- Runtime stage ---
FROM nginx:alpine
# replace the default site config
COPY frontend/nginx.conf /etc/nginx/conf.d/default.conf
# copy built assets
COPY --from=builder /app/frontend/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
